services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      DB_PATH: ${DB_PATH:-/app/data/observability.db}
    command: ["python3", "-m", "uvicorn", "src.api:app", "--host", "0.0.0.0", "--port", "8000"]
    ports:
      - "${API_PORT:-8000}:8000"
    volumes:
      - observability_data:/app/data

  simulator:
    build:
      context: .
      dockerfile: Dockerfile
    command:
      [
        "python3",
        "src/main.py",
        "--db-path",
        "${DB_PATH:-/app/data/observability.db}",
        "--min-interval",
        "0.05",
        "--max-interval",
        "0.25"
      ]
    depends_on:
      - api
    volumes:
      - observability_data:/app/data

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    environment:
      VITE_API_BASE_URL: http://localhost:${API_PORT:-8000}
    command: ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "5173"]
    depends_on:
      - api
    ports:
      - "${FRONTEND_PORT:-5173}:5173"

volumes:
  observability_data:
